#include<iostream>
#include<string>
#include<iomanip>
#include"constans.h"
#include"stop.h"

// прототип типа на std::wstring
using wstr = std::wstring;
// деклорация функции удаления символов табуляции и пробелов из строки
auto Func (wstr&) -> wstr;

// функция по заданию №5
auto Normalize () -> RetConst {

    setlocale(LC_ALL, "ru_RU.UTF8");

    wstr s = L"Задание 5)";
    std::wcout << std::setw(30) << std::right << s << '\n';
    std::wcout << L"Дана строка (максимально 100 символов), содержащая слова, разделенные одним или\n"
                 "несколькими пробелами, или знаками табуляции. Заменить все знаки табуляции знаком\n"
                 "пробела, удалить двойные пробелы из строки." << std::endl;

    bool stop {false}; // переменная для цикла do while
    do {
    std::wcout << L"Введите строку содержащую символы табуляции и двойные пробелы\n"
                  "например:\n           Привет,  Мир     !\n";


    wstr str; // переменная для считывания строки
    // Читаем строку (до 100 символов)
    std::getline(std::wcin, str);
    std::wcout << L"Результат выполнения программы: " << Func (str) << '\n'; // вызов функции
    // вызов функции для останоки или продолжения выполнения программы по выбору пользователя
    if (!(stop == Stop())) return ErrData;
    }
    while (!stop); // выход из праграммы по выбору пользователя
    return Ok;
}

// функция удаления символов табуляции и пробелов из строки
auto Func (wstr& str) -> wstr {

    // Заменяем все табуляции на пробелы
    for (size_t i = 0; i < str.length(); ++i) {
        if (str[i] == '\t') {
            str[i] = ' ';
        }
    }

    // Удаляем двойные (и более) пробелы
    size_t pos = str.find(L"  "); // ищем два пробела подряд
    while (pos != wstr::npos) {
        // заменяем два пробела на один
        str.replace(pos, 2, L" ");
        // продолжаем поиск с той же позиции (после замены может образоваться новый двойной пробел)
        pos = str.find(L"  ", pos);
    }
    return str;
}
